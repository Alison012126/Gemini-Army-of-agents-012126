# Technical Specification: Artistic Intelligence Workspace (v2.0)

## 1. Executive Summary

The **Artistic Intelligence Workspace** is a high-fidelity, client-side Single Page Application (SPA) designed to bridge the gap between aesthetic immersion and rigorous AI utility. Unlike standard utilitarian AI interfaces, this workspace offers a unique "WOW UI" that dynamically adapts its visual identity to the styles of 20 famous painters (e.g., Van Gogh, Monet, Da Vinci), while providing robust tools for Document Intelligence and Multi-Agent orchestration via the Google Gemini API.

The system is built to serve users who require powerful text and multimodal analysis capabilities but desire a personalized, inspiring work environment. Key differentiators include a fully configurable Agent Studio with YAML-based definition management, real-time AI-assisted configuration repair, and a Document Intelligence suite capable of handling complex file inputs with a rich, editable markdown output interface.

---

## 2. System Architecture

### 2.1 Technology Stack

The application leverages a modern, lightweight, and build-free architecture using ES Modules.

*   **Core Framework:** React 19 (via `esm.sh` imports) for component-based UI logic.
*   **Language:** TypeScript (TSX) for type safety and interface definitions.
*   **Styling:** Tailwind CSS (via CDN) for utility-first styling, augmented by dynamic inline CSS for painter themes.
*   **AI Integration:** Google GenAI SDK (`@google/genai` v1.38.0) for direct client-side communication with Gemini models.
*   **Data Visualization:** Recharts (v3.6.0) for dashboard metrics.
*   **Utilities:**
    *   `js-yaml` (v4.1.0): For parsing and dumping agent configuration files.
    *   `lucide-react` (v0.562.0): For consistent iconography.
*   **Font Typography:** Google Fonts (Cinzel, Inter, Playfair Display, Space Grotesk) to match specific artistic eras.

### 2.2 Application Structure

The codebase follows a flat, modular structure rooted in `index.tsx`.

*   **Entry Point:** `index.html` loads the import map and mounts the React root.
*   **Global State:** Managed via React `useState` at the top-level `App.tsx` and propagated via props. This includes `AppSettings` (theme, language, style), `apiKey`, and `currentTab`.
*   **Services:** `geminiService.ts` encapsulates all external API logic to ensure separation of concerns between UI and Data fetching.
*   **Components:** Functional components are divided by feature domain (`Sidebar`, `Dashboard`, `AgentRunner`, `DocumentProcessor`).

### 2.3 Data Flow

1.  **Authentication:** The user provides a Google Gemini API Key via the Sidebar input. This key is stored in the application state and passed to the service layer for every request. No backend server is involved; keys are used directly from the browser.
2.  **Configuration:** Agent definitions are loaded from a hardcoded constant (`AGENTS`) initially but can be overridden by user-uploaded YAML files.
3.  **Inference:**
    *   User inputs (Text/Files) -> `DocumentProcessor` or `AgentRunner`.
    *   Data is formatted (Base64 for images, Text for code) -> sent to `geminiService`.
    *   Response is rendered asynchronously -> UI updates with loading states and final output.

---

## 3. UI/UX Design System ("WOW UI")

The defining feature of the application is its ability to radically transform its visual identity based on the `PainterStyle` selection.

### 3.1 Thematic Engine (`PAINTER_CSS`)

The application utilizes a `PAINTER_CSS` dictionary in `constants.ts` to map specific artistic styles to CSS properties. When a user selects a style (or hits "Jackpot"), the root app container applies these styles dynamically.

*   **Gradients & Backgrounds:**
    *   *Van Gogh:* Uses deep blues and yellows with a `Playfair Display` serif font.
    *   *Monet:* Pastel gradients (`#a8e063`, `#56ab2f`) with `Inter` sans-serif.
    *   *Pollock:* Uses high contrast with a splatter texture overlay.
    *   *Da Vinci:* Simulates parchment paper with sepia tones and `Cinzel` font.
*   **Typography:** Fonts are swapped dynamically to match the era (e.g., Serif for classical/impressionist, Sans/Grotesk for modern/abstract).
*   **Glassmorphism:** The `.glass-panel` CSS class provides a translucent, frosted-glass effect (background blur) that ensures content readability regardless of the complex artistic background behind it.

### 3.2 Accessibility & Internationalization

*   **Bilingual Support:** All interface labels are mapped in `LABELS` for instantaneous switching between English and Traditional Chinese (`繁體中文`).
*   **Theme Toggle:** A dedicated Light/Dark mode toggle adjusts text contrast and the opacity of glass panels (`bg-white/80` vs `bg-gray-900/80`) to ensure legibility.
*   **Collapsible Sidebar:** To maximize workspace area, especially for the Document Intelligence view, the sidebar can be collapsed into a compact icon-only mode.

---

## 4. Functional Modules

### 4.1 Sidebar & Navigation

The Sidebar serves as the command center for the application.

*   **API Key Management:** A secure input field (password type with visibility toggle) allows users to inject their Gemini API key. Visual indicators in the main header (System Status: Operational/Key Missing) reflect this state.
*   **Style Jackpot:** A randomization function that selects one of the 20 painter styles at random.
*   **Global Settings:** Toggle switches for Theme (Dark/Light) and Language (EN/TC).

### 4.2 Dashboard

A visual landing page displaying mock analytical data to demonstrate the potential for usage tracking.
*   **Metrics:** Displays Total Runs, Active Agents, and Latency using Lucide icons.
*   **Charts:** Uses `Recharts` to render:
    *   *Token Usage Trends:* Line chart visualizing consumption over time.
    *   *Model Distribution:* Bar chart showing preference between Gemini, GPT, and Claude models.
*   **Tooltip Customization:** Chart tooltips adapt to the active Theme (Dark/Light) for visibility.

### 4.3 Agent Studio (formerly Agent Runner)

This module allows users to interact with and manage AI personas defined in `agents.yaml`.

*   **Execution Mode:**
    *   **Agent Selection:** Dropdown to select from loaded agents (e.g., FDA Search Agent, Translator).
    *   **Context Injection:** The system automatically injects a system prompt: `You are the {Agent Name}. {Description}. Language Preference: {Language}.`
    *   **Model Override:** Users can override the default model defined in the agent config with other models (e.g., `gemini-3-pro-preview`, `gpt-4o-mini`).
*   **Management Mode:**
    *   **YAML Editor:** A built-in text editor allows users to manually modify the `agents.yaml` structure.
    *   **File I/O:** Users can Download the current configuration as a `.yaml` file or Upload an existing one.
    *   **AI-Assisted Repair:** If a user uploads a malformed or non-standard file (e.g., a text list of agents), the **Repair** function sends the content to Gemini with a strict schema definition. The AI reconstructs valid YAML, which `js-yaml` then parses into the application state.

### 4.4 Document Intelligence

A robust interface for analyzing text and files.

*   **Input Methods:**
    *   *Upload Mode:* Supports `.txt`, `.md`, `.pdf`, `.png`, and `.jpg`.
        *   **Preview:** Images are previewed via Data URLs. Text files are read via `FileReader` and displayed in a scrollable preview window.
    *   *Paste Mode:* A large textarea for direct text or Markdown input.
*   **Processing Logic:**
    *   *Text-based:* Combines file content + user prompt and sends to `gemini-3-flash-preview`.
    *   *Multimodal (Image/PDF):* Encodes the file to Base64 and sends to `gemini-2.5-flash` (optimized for multimodal tokens) alongside the prompt.
*   **Interactive Results Editor:**
    *   **Markdown View:** The output is rendered in a monospaced editor.
    *   **Zoom Controls:** Users can increase/decrease font size (range 10px - 32px) for better readability.
    *   **Download:** Users can export the analysis result as either Markdown (`.md`) or Plain Text (`.txt`).
    *   **Editability:** The result window is fully editable, allowing users to refine the AI's output before downloading.

---

## 5. API Integration & Data Models

### 5.1 Service Layer (`geminiService.ts`)

The application acts as a direct wrapper around the `@google/genai` SDK.

**Function: `generateContent`**
*   **Parameters:** `apiKey`, `model`, `prompt`, `systemInstruction`, `inlineData` (optional mimeType/data pair).
*   **Logic:**
    *   Instantiates `GoogleGenAI`.
    *   Constructs the `contents` payload. If `inlineData` is present (for images/PDFs), it creates a multimodal part object; otherwise, it sends a text part.
    *   Configures `temperature` to 0.4 for balanced creativity/accuracy.
    *   Returns `response.text`.

**Function: `repairAgentYaml`**
*   **Purpose:** To standardize user-uploaded configurations.
*   **Model:** Uses `gemini-3-flash-preview` for high-speed reasoning.
*   **Prompting strategy:** Uses a strict schema definition (`interface Agent {...}`) and instructs the model to return *only* the YAML string within a code block, stripping markdown formatting before returning to the UI.

### 5.2 Data Types (`types.ts`)

*   **`Agent`**:
    ```typescript
    interface Agent {
      id: string;
      name_en: string;
      name_tc: string;      // Traditional Chinese Name
      category_tc: string;  // Category in TC
      description_tc: string;
      model: string;        // e.g., gemini-3-flash-preview
      default_temperature: number;
    }
    ```
*   **`AppSettings`**: Controls global state (`theme`, `language`, `painterStyle`).
*   **`PainterStyle`**: String union type of the 20 supported artists.

---

## 6. Implementation Details & Constraints

### 6.1 State Management
The app avoids complex state management libraries (Redux/Zustand) in favor of React's native `useState` lifted to `App.tsx`. This reduces bundle size and complexity for this scope. The `agents` state in `AgentRunner` is local but initialized from the global constant, allowing for session-based modifications without persistent database storage.

### 6.2 Security
*   **API Keys:** Keys are never logged or sent to any third-party server. They exist only in the browser's memory during the session.
*   **Input Validation:** The YAML parser wraps `yaml.load` in try-catch blocks to prevent application crashes from malformed user uploads.

### 6.3 Performance
*   **Dynamic Imports:** The use of `esm.sh` allows for browser-native caching of React and Gemini SDK dependencies.
*   **Rendering:** The "Painter Style" is applied via a single style object on the root container, minimizing DOM reflows compared to swapping entire stylesheets.
*   **Asset Handling:** File uploads are processed entirely in the browser using `FileReader`. Large files are converted to Base64 strings. *Note: Browser memory limits apply to file uploads.*

### 6.4 Browser Compatibility
*   Requires a modern browser supporting ES Modules and `importmap` (Chrome, Edge, Firefox, Safari).
*   Requires `FileReader` API support for Document Intelligence.

---

## 7. Future Roadmap Recommendations

While the current specification delivers a functional and aesthetically unique MVP, the following areas are identified for future expansion:

1.  **Persistent Storage:** Implement `localStorage` or `IndexedDB` to save the API Key (encrypted), modified Agent configurations, and `PainterStyle` preference between sessions.
2.  **Streaming Responses:** Update `geminiService` to use `generateContentStream` to provide a typewriter effect, improving perceived latency for long document analyses.
3.  **Markdown Rendering:** Currently, the output is displayed in a `textarea`. Integrating a library like `react-markdown` would allow for rich rendering (bolding, headers, tables) alongside the raw editing view.
4.  **Audio/Video Intelligence:** Extend the Document Intelligence module to support Audio/Video file inputs using the Gemini 1.5/2.0 multimodal capabilities.

---
*End of Specification*
