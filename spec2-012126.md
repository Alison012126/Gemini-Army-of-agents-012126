# Technical Specification: ArtFlow Multi-Agent Workspace

**Version:** 1.0  
**Date:** October 26, 2023  
**Status:** Released  

---

## 1. Executive Summary

**ArtFlow** is a cutting-edge, web-based multi-agent Large Language Model (LLM) workspace designed to bridge the gap between aesthetic immersion and professional productivity. Unlike utilitarian interfaces common in the AI space, ArtFlow introduces a "WOW UI" philosophy—a dynamic, visually responsive environment that adapts its entire aesthetic (color palettes, typography, layout) to the styles of 20 famous painters, from Van Gogh to Basquiat.

Functionally, the application serves as a robust platform for managing a workforce of 30+ specialized AI agents. It features a bilingual interface (English/Traditional Chinese), real-time domain adaptation for medical regulatory compliance (FDA 510(k)), and a sophisticated "Agent Studio" for customizing agent behaviors and standardized configuration management. Built on React and the Google Gemini API, ArtFlow demonstrates how generative AI can drive both the backend logic and the frontend configuration of modern web applications.

---

## 2. System Architecture

### 2.1 Technology Stack

*   **Frontend Framework:** React 19 (ESM based).
*   **Language:** TypeScript 5.0.
*   **Styling:** Tailwind CSS (Utility-first), Inline Dynamic Styles for theming.
*   **LLM Provider:** Google Gemini API (`@google/genai` SDK).
*   **State Management:** React Hooks (`useState`, `useEffect`, `useRef`).
*   **Data Serialization:** `js-yaml` for configuration management.
*   **Visualization:** `recharts` for analytics dashboards.
*   **Icons:** `lucide-react` for consistent, vector-based iconography.
*   **Build/Runtime:** Browser-native ES Modules (via `importmap`), no build step required for rapid prototyping.

### 2.2 Application Structure

The application follows a modular component-based architecture:

*   **Root (`App.tsx`):** Acts as the central state container, managing global preferences (Theme, Language, Style), user session data (Chat History, Analytics), and the active view routing.
*   **Navigation (`Sidebar.tsx`):** A persistent, responsive navigation hub that houses the "Neural Core" status indicator, agent selection list, and global settings.
*   **Feature Modules:**
    *   **`ChatInterface.tsx`:** The primary interaction layer for text-based communication with agents, supporting file attachments and markdown rendering.
    *   **`DomainAnalysis.tsx`:** A specialized vertical for regulatory workflows, featuring multi-step state management (Upload -> Checklist -> Report).
    *   **`AgentManager.tsx` (Agent Studio):** An administrative dashboard for CRUD operations on agent configurations, featuring an LLM-powered YAML standardization pipeline.
    *   **`Analytics.tsx`:** A data visualization dashboard tracking token usage and interaction metrics.
*   **Service Layer (`geminiService.ts`):** A singleton abstraction wrapper for the Google GenAI SDK, handling authentication, error boundaries, and model parameter injection.

---

## 3. UI/UX Design Specification ("WOW UI")

The "WOW UI" is the defining characteristic of ArtFlow, prioritizing emotional engagement and visual delight without sacrificing usability.

### 3.1 The Painter Style Engine

The visual identity of the application is fluid. It is governed by a `PainterStyle` interface that dictates the color theory and typography of every component.

**Data Structure:**
```typescript
interface PainterStyle {
  id: string;
  name: string;
  palette: {
    primary: string;    // Main interaction elements, headers
    secondary: string;  // Borders, subtle backgrounds, accents
    accent: string;     // Call-to-actions, highlights
    background: string; // Global app background
    text: string;       // Readable text color
    panel: string;      // Component container backgrounds (Dark mode specific)
  };
  fontPairing: string;  // 'Merriweather' (Serif) or 'Roboto' (Sans)
  description: string;
}
```

**Implemented Styles (20 Distinct Themes):**
1.  **Van Gogh:** Deep blues (`#1d3354`) and starry yellows (`#d4a017`).
2.  **Monet:** Soft pastels, misty blues, and lily-pad greens.
3.  **Picasso:** Cubist vibrancy with primary reds, yellows, and blues.
4.  **Dalí:** Surrealist purples and melting oranges.
5.  **Rembrandt:** Chiaroscuro high-contrast dark browns and golds.
6.  **Kahlo:** Vibrant Mexican folk colors (reds, greens).
7.  **Hokusai:** Indigo blues and wave-crest whites.
8.  **Klimt:** Gold leaf metallic, black, and ornate patterns.
9.  **Warhol:** Neon pop-art pinks, cyans, and yellows.
10. **O'Keeffe:** Floral pinks and deep violets.
11. **Matisse:** Fauvist cut-out colors (blue, orange, green).
12. **Pollock:** Chaotic splatter colors on canvas whites.
13. **Munch:** Expressionist orange and dark teal.
14. **Hopper:** Melancholic teal and diner yellows.
15. **Basquiat:** Neo-expressionist black, chaotic red, and yellow.
16. **Renoir:** Soft, luminous pinks and lavenders.
17. **Cézanne:** Earthy tones, ochres, and olive greens.
18. **Kandinsky:** Geometric blues, reds, and yellows.
19. **Rothko:** Color field blocks of deep red and orange.
20. **Vermeer:** Dutch golden light and lapis lazuli.

### 3.2 Dual-Axis Theming

The application supports a two-dimensional theme matrix:
1.  **Style Axis:** The selected Painter Style (e.g., Van Gogh).
2.  **Luminosity Axis:** Light Mode vs. Dark Mode.

**Logic:**
*   **Light Mode:** Uses the style's defined background and text colors directly. Panels often use semi-transparent whites (`rgba(255,255,255,0.5)`) to create a "frosted glass" effect over the textured background.
*   **Dark Mode:** Overrides the global background with the style's `palette.background` (usually dark). Panels utilize the `palette.panel` color (opaque) to ensure readability and contrast against the dark backdrop.

### 3.3 The "Style Jackpot"

To gamify the experience, a **Style Jackpot** mechanism is implemented.
*   **Trigger:** A "SPIN!" button in the sidebar.
*   **Visuals:** A modal overlay featuring a spinning animation that cycles through styles rapidly.
*   **Behavior:** It creates anticipation by accelerating and decelerating the cycle, finally landing on a random style and automatically applying it to the entire application state.

### 3.4 Neural Core Status Indicator

Located prominently in the sidebar, this component provides immediate, visceral feedback on the system's operational state.
*   **Idle/Connected:** Glowing Green LED (`#22c55e`) with a steady pulse. Text: "NEURAL CORE ONLINE".
*   **Thinking/Processing:** Rapidly pulsing Blue LED (`#3b82f6`) with a spinner icon. Text: "PROCESSING...".
*   **Error:** Static Red LED (`#ef4444`) with an alert icon. Text: "CONNECTION ERROR".

---

## 4. Functional Specifications

### 4.1 Multi-Agent System

The application comes pre-configured with 30+ agents, each defined by a persona and a specific operational model.

**Agent Interface:**
```typescript
interface Agent {
  id: string;
  name: string;
  role: string;
  category: string;     // e.g., Support, Development, HR
  description: string;
  model: string;        // Specific Gemini model version
  systemInstruction?: string; // Custom behavior override
}
```

**User Interaction:**
*   **Search & Filtering:** A real-time search bar in the sidebar filters agents by name.
*   **Selection:** Clicking an agent sets the `selectedAgent` state, updating the Chat Interface header and changing the `systemPrompt` used for subsequent API calls.
*   **Visual Feedback:** The active agent is highlighted in the sidebar using the current theme's accent color.

### 4.2 Chat Interface

The chat window is the primary workspace.
*   **Message Bubbles:**
    *   **User:** Right-aligned, colored with `palette.primary`, white text.
    *   **Agent:** Left-aligned, colored with `palette.panel` (or white), text colored with `palette.text`.
*   **Markdown Support:** Agent responses are rendered with whitespace preservation to support code blocks and structured text.
*   **Document Attachment:**
    *   **Upload:** Supports `.txt`, `.md`, `.json`, `.csv`.
    *   **Paste:** A modal allows users to paste raw text and title it as a markdown document.
    *   **Context Injection:** Attached documents are not just UI decoration; their content is dynamically appended to the System Prompt sent to Gemini, allowing for RAG-like (Retrieval-Augmented Generation) behavior within a session.
*   **PDF Preview:** A "PDF View" modal simulates a print-ready layout of attached documents.

### 4.3 Agent Studio (Manager)

This advanced feature allows users to modify the AI workforce.

**Features:**
1.  **Edit Agent:**
    *   **Model Selection:** Dropdown to switch between `gemini-2.5-flash` (faster, lower cost) and `gemini-3-flash-preview` (higher reasoning capability).
    *   **System Prompt Editor:** A large text area to refine the agent's persona. Defaults to the agent's description but allows for detailed "You are..." instructions.
2.  **Configuration Persistence:**
    *   **Export:** Dumps the current array of Agent objects to a standardized `agents.yaml` file.
    *   **Import:** Reads a `agents.yaml` file to overwrite the current state.
3.  **LLM-Powered Standardization:**
    *   If a user uploads a file that is *not* valid YAML or follows a different schema (e.g., a raw text list of job descriptions), the application detects the parsing error.
    *   It automatically triggers a specialized "Data Standardization Agent" (using Gemini).
    *   **Prompt Strategy:** "You are a Data Standardization Agent. Transform the following raw text/data into a strictly standard YAML format... Output ONLY the valid YAML."
    *   The result is parsed and applied, seamlessly converting unstructured data into structured application config.

### 4.4 Domain Adaptation: 510(k) Analysis

This module demonstrates the application's ability to handle complex, domain-specific workflows (Medical Device Regulation).

**Workflow:**
1.  **Tab 1: Upload:**
    *   User uploads regulatory documents (Device Description, Risk Management File, etc.).
    *   Files are stored in memory (`UploadedFile[]`).
2.  **Tab 2: Checklist:**
    *   Interactive list of FDA 510(k) requirements (e.g., "Biocompatibility Testing").
    *   User manually toggles items that they believe are complete.
3.  **Tab 3: Report (Analysis):**
    *   **Trigger:** User clicks "Analyze".
    *   **Prompt Engineering:** The application constructs a massive prompt containing:
        *   The content of all uploaded files (truncated to fit context window).
        *   The boolean status of the checklist items.
        *   Task: "Analyze provided documents... Identify gaps... Generate professional status report."
    *   **Output:** A markdown-formatted compliance report generated by Gemini, identifying missing sections based on the checklist and content analysis.

### 4.5 Internationalization (i18n)

The app is fully bilingual.
*   **Languages:** English (EN) and Traditional Chinese (TC).
*   **Mechanism:** A dictionary object `TRANSLATIONS` maps keys to strings.
*   **Scope:** Covers all UI labels, button text, and static headers.
*   **LLM Context:** The selected language is passed to the System Prompt ("Please respond in Traditional Chinese"), ensuring the AI agent responds in the correct language regardless of the user's input language.

---

## 5. Technical Implementation Details

### 5.1 Gemini Service Integration

The `geminiService.ts` module encapsulates the complexity of the API interactions.

*   **Initialization:** It securely initializes the `GoogleGenAI` client using `process.env.API_KEY`. It includes a check to prevent crashing if the key is missing (though the UI will show an error state).
*   **Dynamic Model Routing:** The `generateResponse` function accepts a `modelName` parameter. This is critical for the Agent Studio feature, allowing different agents to target different model versions based on the complexity of their task.
*   **Error Handling:** Wraps calls in `try/catch` blocks. On failure, it returns a descriptive error string to the UI and triggers the `AppStatus` to transition to 'error', turning the Neural Core red.

### 5.2 State Management & React Hooks

*   **`useRef` for Scrolling:** Used in `ChatInterface` to auto-scroll to the bottom when new messages arrive.
*   **`useEffect` for Theme Injection:**
    *   The body background color and font family are set directly on the `document.body.style` inside a `useEffect`.
    *   This ensures that the "Painter Style" permeates the entire DOM, not just the React root, preventing white flashes during scrolling or overscrolling.
*   **`useState` for Data Flow:** Complex state objects (like `AnalyticsData`) are managed centrally in `App.tsx` and passed down via props, ensuring a "Single Source of Truth."

### 5.3 YAML Processing

The inclusion of `js-yaml` via the `importmap` allows for client-side parsing.
*   **Security:** By processing YAML in the browser, user data (agent configs) never leaves the client unless explicitly sent to the LLM for standardization.
*   **Resilience:** The import logic first attempts a strict parse. If that fails (due to syntax errors or unstructured text), it falls back to the LLM standardization pipeline, making the import feature extremely robust and user-friendly.

---

## 6. Data Models & Analytics

### 6.1 Analytics Data
The application tracks usage metrics locally to simulate a professional workspace dashboard.

```typescript
interface AnalyticsData {
  tokensUsed: number;          // Simulated token counter (randomized increment)
  messagesCount: number;       // Total messages exchanged
  agentUsage: Record<string, number>; // Histogram of agent popularity
  history: { date: string; count: number }[]; // Time-series data for line charts
}
```

*   **Visualization:** Uses `Recharts` to render:
    *   **Bar Chart:** Agent Usage Distribution.
    *   **Line Chart:** Activity Over Time.
*   The charts dynamically inherit colors from the active `PainterStyle`, ensuring the data visualization matches the artistic theme (e.g., Starry Night blues for the bars in Van Gogh mode).

---

## 7. Future Roadmap

1.  **Persistent Storage:** Integrate `localStorage` or IndexedDB to save Chat History and Agent Configs between page reloads.
2.  **Streaming Responses:** Upgrade `geminiService` to use `generateContentStream` for a typewriter effect during generation.
3.  **Multimodal Inputs:** Enable image upload in the Chat Interface to leverage Gemini's vision capabilities.
4.  **Voice Mode:** Implement Speech-to-Text and Text-to-Speech using the Web Speech API for hands-free agent interaction.
5.  **RAG Pipeline:** Implement a vector store (client-side via TensorFlow.js or similar) for semantic search over larger uploaded documents, rather than injecting full text into the context window.

---

**End of Specification**
